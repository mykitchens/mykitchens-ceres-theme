<script>
"use strict";

var _ApiService1 = require("/js/src/app/services/ApiService");

var _ApiService2 = _interopRequireDefault(_ApiService1);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

this.ceresStore.registerModule('compareList', {

    state: {
        compareListIds: [],
        compareListItems: []
    },

    mutations: {
        setcompareListItems: function setcompareListItems(state, compareListItems) {
            state.compareListItems = compareListItems;
        },
        setcompareListIds: function setcompareListIds(state, compareListIds) {
            state.compareListIds = compareListIds.map(Number);
        },
        removecompareListItem: function removecompareListItem(state, compareListItem) {
            state.compareListItems = state.compareListItems.filter(function (item) {
                return item !== compareListItem;
            });
        },
        removecompareListId: function removecompareListId(state, id) {
            state.compareListIds = state.compareListIds.filter(function (compareListId) {
                return compareListId !== id;
            });
        },
        addcompareListItemToIndex: function addcompareListItemToIndex(state, compareListItem, index) {
            state.compareListItems.splice(index, 0, compareListItem);
        },
        addcompareListId: function addcompareListId(state, id) {
            state.compareListIds.push(id);
        }
    },

    actions: {
        initcompareListItems: function initcompareListItems(_ref, ids) {
            var commit = _ref.commit;

            return new Promise(function (resolve, reject) {
                if (ids && ids[0]) {
                    commit("setcompareListIds", ids);

                    _ApiService2.get("/rest/io/variations/", { variationIds: ids, template: "Ceres::compareList.compareList" }).done(function (data) {
                        commit("setcompareListItems", data.documents);
                        resolve(data);
                    }).fail(function (error) {
                        reject(error);
                    });
                } else {
                    resolve();
                }
            });
        },
        removeCompareListItem: function removeCompareListItem(_ref2, _ref3) {
            var commit = _ref2.commit;
            var id = _ref3.id,
                compareListItem = _ref3.compareListItem,
                index = _ref3.index;

            return new Promise(function (resolve, reject) {
                if (compareListItem) {
                    commit("removeCompareListItem", compareListItem);
                }

                _ApiService2.delete("/rest/io/itemCompareList/" + id).done(function (data) {
                    commit("removeCompareListId", id);
                    resolve(data);
                }).fail(function (error) {
                    if (index) {
                        commit("addCompareListItemToIndex", compareListItem, index);
                    }
                    reject(error);
                });
            });
        },
        addToCompareList: function addToCompareList(_ref4, id) {
            var commit = _ref4.commit;

            return new Promise(function (resolve, reject) {
                commit("addCompareListId", id);
                _ApiService2.post("/rest/io/itemCompareList", { variationId: id }).done(function (data) {
                    resolve(data);
                }).fail(function (error) {
                    commit("removeCompareListId", id);
                    reject(error);
                });
            });
        }
    },

    getters: {
        compareListCount: function compareListCount(state) {
            return state.compareListIds.length;
        }
    }
})
</script>
